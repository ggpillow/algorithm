# Вариант 4
## Постановка задачи
Задача о рюкзаке (англ. Knapsack problem) — дано N предметов, n<sub>i</sub> предмет имеет массу w<sub>i</sub> > 0 и стоимость p<sub>i</sub> > 0. Необходимо выбрать из этих предметов такой набор, чтобы суммарная масса не превосходила заданной величины W (вместимость рюкзака), а суммарная стоимость была максимальна. 

## Условия задачи
|    **Предметы**   | **A** | **B** | **C** | **D** | **E** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   4   |   3   |   3   |   8   |   6   |
| **Вес**           |   8  |  3   |   12   |   4   |   2   |

Ограничение вместимости - 16 у.е.
Сложим вес всех предметов: 8 + 3 + 12 + 4 + 2 = 29 > 16, значит все предметы не помещаются в рюкзак.

## Шаг 1. Вычисляем ценность каждого предмета и сортируем
Ценность предмета - это отношение его стоимости к весу: c<sub>i</sub> = $\frac{s<sub>i</sub>}{w<sub>i</sub>}
Ценность каждого предмета:
|    **Предметы**   | **A** | **B** | **C** | **D** | **E** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   4   |   3   |   3   |   8   |   6   |
| **Вес**           |   8   |   3   |   12   |  4   |  2   |
| **Ценность**      |$\frac{1}{2}$|   1   |$\frac{1}{4}$|  2  |  3  |

Сортируем предметы в порядке уменьшения их ценности

|    **Предметы**   | **E** | **D** | **B** | **A** | **С** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   6   |   8   |   3   |   4   |   3   |
| **Вес**           |   2   |   4   |   3   |  8   |  12   |
| **Ценность**      |   3   |   2   |   1   |$\frac{1}{2}$|$\frac{1}{4}$|

## Шаг 2. Вычислим оценку перспективности (Оценка корня дерева)
Представим, что самого ценного предмета из тех, что еще не обработаны, у нас бесконечное количество и мы можем делить его на сколь угодно малые части. Тогда мы можем все оставшееся в рюкзаке место заполнить этим предметом. Тогда ценность будет

$$
3 * 16 = 48
$$

Это значение будет корнем нашего дерева, оно представляет оценку перспективности для задачи в целом. Стоимость рюкзака ни при каком варианте не может превысить 48.

## Шаг 3. Ветвление из корня по предмету E
Разобьем множество решений на два подмножества и начнем строить дерево. Левым потомком будет подмножество решений, в которых мы взяли самый ценный из оставшихся предметов, правым - где не взяли. 
* Левый потомок: предмет E кладём в рюкзак
* Правый потомок: предмет E не кладём в рюкзак

Оценка перспективности левого потомка:
* Вес предмета E = 2, поэтому остается вместимость 16 - 2 = 14
* Стоимость в рюкзаке: 0 + 6 = 6
* У следующего предмета ценность 2

$$
6 + 14 * 2 = 6 + 28 = 34
$$

Оценка перспективности правого потомка: 
* Остаточная вместимость: 16
* Стоимость в рюкзаке: 0
* У следующего предмета ценность 2

$$
16 * 2 = 32
$$


``` mermaid
flowchart TD
A(68)
B(53)
C(51)
A -- +E--> B
A -- -E--> C

style B fill:#4f4f
```

Повторяем шаг 3 и продолжаем строить дерево из самой перспективной вершины.

Оценка перспективности левого потомка -

$$
8 + 6 + (17 - 2 - 2) * 2 = 14 + 13 * 2 = 40 
$$

Оценка перспективности правого потомка - 

$$
8 + (17 - 2) * 2 = 38
$$

``` mermaid
flowchart TD
A(68)
B(53)
C(51)
D(40)
E(38)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E

style C fill:#4f4f
```

Заметим, что самая перспективная вершина оказалась на другой ветке. Продолжаем строить из вершины с оценкой 51.

Оценка перспективности левого потомка -

$$
6 + (17 - 2) * 2 = 6 + 15 * 2 = 36 
$$

Оценка перспективности правого потомка - 

$$
17 * 2 = 34
$$

``` mermaid
flowchart TD
A(68)
B(53)
C(51)
D(40)
E(38)
F(36)
G(34)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- +D--> G

style D fill:#4f4f
```

Самая перспективная вершина - 40.

Оценка перспективности левого потомка -

$$
14 + 8 + (15 - 4) * \frac{1}{2} = 24 + 11 * \frac{1}{2} = 29,5 
$$

Оценка перспективности правого потомка - 

$$
14 + 13 * \frac{1}{2} = 20,5
$$

``` mermaid
flowchart TD
A(68)
B(53)
C(51)
D(40)
E(38)
F(36)
G(34)
H(29,5)
I(20,5)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I

style E fill:#4f4f
```

Самая перспективная вершина - 38.

Оценка перспективности левого потомка -

$$
8 + 8 + (15 - 4) * \frac{1}{2} = 16 + 11 * \frac{1}{2} = 21,5 
$$

Оценка перспективности правого потомка - 

$$
8 + 15 * \frac{1}{2} = 15,5
$$

``` mermaid
flowchart TD
A(68)
B(53)
C(51)
D(40)
E(38)
F(36)
G(34)
H(29,5)
I(20,5)
J(21,5)
K(15,5)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K

style F fill:#4f4f
```

Самая перспективная вершина - 36.

Оценка перспективности левого потомка -

$$
6 + 8 + (15 - 4) * \frac{1}{2} = 14 + 11 * \frac{1}{2} = 19,5 
$$

Оценка перспективности правого потомка - 

$$
6 + 15 * \frac{1}{2} = 13,5
$$

``` mermaid
flowchart TD
A(68)
B(53)
C(51)
D(40)
E(38)
F(36)
G(34)
H(29,5)
I(20,5)
J(21,5)
K(15,5)
L(19,5)
M(13,5)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K
F -- +C--> L
F -- -C--> M

style H fill:#4f4f
```

Самая перспективная вершина - 34.

Оценка перспективности левого потомка -

$$
22 + 6 + (17 - 20) * \frac{1}{4} = 28 + -3 * \frac{1}{4} 
$$
Получили отрицательное значение, что значит предмет не поместится в рюкзак. Соответственно от этой вершины мы не будем продолжать поиск.

Оценка перспективности правого потомка - 

$$
22 + 9 * \frac{1}{4} = 24,25
$$

``` mermaid
flowchart TD
A(68)
B(53)
C(51)
D(40)
E(38)
F(36)
G(34)
H(29,5)
I(20,5)
J(21,5)
K(15,5)
L(19,5)
M(13,5)
N(14,5)
O(8,5)
P(X)
Q(24,25)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K
F -- +C--> L
F -- -C--> M
G -- +C--> N
G -- -C--> O
H -- +A--> P
H -- -A--> Q

style P fill:#FF0000
style Q fill:#4f4f
```

Самая перспективная вершина - 24,25.

Оценка перспективности левого потомка -

$$
22 + 3 + (17 - 20) * \frac{1}{4} = 25 + -3 * \frac{1}{4} 
$$

Снова получили отрицательное значение - не рассматриваем эту вершину

Оценка перспективности правого потомка = 22

``` mermaid
flowchart TD
A(68)
B(53)
C(51)
D(40)
E(38)
F(36)
G(34)
H(29,5)
I(20,5)
J(21,5)
K(15,5)
L(19,5)
M(13,5)
N(14,5)
O(8,5)
P(X)
Q(24,25)
R(X)
S(22)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +C--> H
D -- -C--> I
E -- +C--> J
E -- -C--> K
F -- +C--> L
F -- -C--> M
G -- +C--> N
G -- -C--> O
H -- +A--> P
H -- -A--> Q
Q -- +B--> R
Q -- -B--> S

style P fill:#FF0000
style R fill:#FF0000
style S fill:#4f4f
```

Поскольку мы опустились до самого нижнего уровня (рассмотрели все предметы) и вершина на самом нижнем уровне является самой перспективной, то это и будет ответом.

Чтобы восстановить все положенные в рюкзак предметы пройдемся по ребрам, которые привели нас к ответу.

## Ответ
В рюкзак пойдут предметы E, D, C. Максимальная стоимость рюкзака: 8 + 6 + 8 = 22.
